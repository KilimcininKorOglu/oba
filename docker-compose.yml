services:
  oba:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "1389:1389"
      - "8080:8080"
    volumes:
      - ./docker-data:/var/lib/oba
    environment:
      - OBA_LOG_LEVEL=debug
    command: ["serve", "--config", "/var/lib/oba/config.yaml"]
    restart: unless-stopped

  web:
    build:
      context: ./web
      dockerfile: Dockerfile
    ports:
      - "3000:80"
    depends_on:
      - oba
    restart: unless-stopped

  oba-dev:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "2389:1389"
    volumes:
      - .:/app
      - ./docker-data:/var/lib/oba
    environment:
      - OBA_LOG_LEVEL=debug
    command: ["go", "run", "./cmd/oba", "serve", "--config", "/var/lib/oba/config.yaml"]
    profiles:
      - dev
