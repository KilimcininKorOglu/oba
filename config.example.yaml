# Oba LDAP Server Configuration
# All available configuration options with their default values

# Server configuration
server:
  # LDAP listen address (use :1389 for non-root users)
  address: ":1389"
  # LDAPS (TLS) listen address (empty to disable)
  tlsAddress: ""
  # Path to TLS certificate file
  tlsCert: ""
  # Path to TLS private key file
  tlsKey: ""
  # Maximum concurrent connections
  maxConnections: 10000
  # Read timeout per operation
  readTimeout: 30s
  # Write timeout per operation
  writeTimeout: 30s
  # PID file path (for reload command)
  pidFile: "/var/run/oba.pid"

# Directory configuration
directory:
  # Base distinguished name
  baseDN: "dc=example,dc=com"
  # Administrator DN
  rootDN: "cn=admin,dc=example,dc=com"
  # Administrator password (use environment variable in production)
  rootPassword: "admin"

# Storage engine configuration
storage:
  # Data directory path (absolute or relative)
  dataDir: "/var/lib/oba"
  # WAL directory (defaults to dataDir if empty)
  walDir: ""
  # Page size in bytes (4096, 8192, 16384, or 32768)
  pageSize: 4096
  # Buffer pool size (e.g., "256MB", "1GB")
  bufferPoolSize: "256MB"
  # Checkpoint interval
  checkpointInterval: 5m
  # Entry cache size (LRU cache for frequently accessed entries)
  cacheSize: 10000

# Logging configuration
logging:
  # Log level: debug, info, warn, error
  level: "info"
  # Log format: json, text
  format: "json"
  # Output: stdout, stderr, or file path
  output: "stdout"
  # Log storage configuration (ObaDB)
  store:
    # Enable log storage for querying via REST API
    enabled: false
    # Path to log database directory
    dbPath: "./data/log"
    # Maximum number of log entries to keep
    maxEntries: 100000

# Security configuration
security:
  # Password policy settings
  passwordPolicy:
    # Enable password policy enforcement
    enabled: false
    # Minimum password length
    minLength: 8
    # Require at least one uppercase letter
    requireUppercase: true
    # Require at least one lowercase letter
    requireLowercase: true
    # Require at least one digit
    requireDigit: true
    # Require at least one special character
    requireSpecial: false
    # Password expiration (0 = never expires)
    maxAge: 0
    # Number of old passwords to remember (0 = no history)
    historyCount: 0

  # Rate limiting / account lockout settings (hot-reloadable)
  rateLimit:
    # Enable rate limiting
    enabled: false
    # Maximum failed authentication attempts before lockout
    maxAttempts: 5
    # Account lockout duration (auto-unlock after this period)
    lockoutDuration: 15m

  # Encryption at rest settings
  encryption:
    # Enable encryption for stored data (AES-256-GCM)
    enabled: false
    # Path to encryption key file (32 bytes raw or 64 hex chars)
    # Generate with: openssl rand -hex 32 > /etc/oba/encryption.key
    keyFile: ""

# Access Control List configuration
# Use external ACL file for hot reload support.
# Changes to the file are detected automatically (~300ms).
# Manual reload: kill -SIGHUP $(cat /var/run/oba.pid) or: oba reload acl
# See examples/acl.example.yaml for format documentation.
aclFile: "/etc/oba/acl.yaml"

# REST API configuration
rest:
  # Enable REST API
  enabled: false
  # HTTP listen address
  address: ":8080"
  # HTTPS listen address (uses server.tlsCert and server.tlsKey)
  tlsAddress: ""
  # JWT secret for token signing (generate with: openssl rand -hex 32)
  jwtSecret: ""
  # Token TTL (time-to-live)
  tokenTTL: 24h
  # Rate limit (requests per second per IP, 0 = disabled)
  rateLimit: 100
  # CORS allowed origins
  corsOrigins:
    - "*"
