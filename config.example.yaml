# Oba LDAP Server Configuration
# All available configuration options with their default values

# Server configuration
server:
  # LDAP listen address (use :1389 for non-root users)
  address: ":1389"
  # LDAPS (TLS) listen address (empty to disable)
  tlsAddress: ""
  # Path to TLS certificate file
  tlsCert: ""
  # Path to TLS private key file
  tlsKey: ""
  # Maximum concurrent connections
  maxConnections: 10000
  # Read timeout per operation
  readTimeout: 30s
  # Write timeout per operation
  writeTimeout: 30s

# Directory configuration
directory:
  # Base distinguished name
  baseDN: "dc=example,dc=com"
  # Administrator DN
  rootDN: "cn=admin,dc=example,dc=com"
  # Administrator password (use environment variable in production)
  rootPassword: "admin"

# Storage engine configuration
storage:
  # Data directory path (absolute or relative)
  dataDir: "/var/lib/oba"
  # WAL directory (defaults to dataDir if empty)
  walDir: ""
  # Page size in bytes (4096, 8192, 16384, or 32768)
  pageSize: 4096
  # Buffer pool size (e.g., "256MB", "1GB")
  bufferPoolSize: "256MB"
  # Checkpoint interval
  checkpointInterval: 5m
  # Entry cache size (LRU cache for frequently accessed entries)
  cacheSize: 10000

# Logging configuration
logging:
  # Log level: debug, info, warn, error
  level: "info"
  # Log format: json, text
  format: "json"
  # Output: stdout, stderr, or file path
  output: "stdout"

# Security configuration
security:
  # Password policy settings
  passwordPolicy:
    # Enable password policy enforcement
    enabled: false
    # Minimum password length
    minLength: 8
    # Require at least one uppercase letter
    requireUppercase: true
    # Require at least one lowercase letter
    requireLowercase: true
    # Require at least one digit
    requireDigit: true
    # Require at least one special character
    requireSpecial: false
    # Password expiration (0 = never expires)
    maxAge: 0
    # Number of old passwords to remember (0 = no history)
    historyCount: 0

  # Rate limiting / account lockout settings
  rateLimit:
    # Enable rate limiting
    enabled: false
    # Maximum failed authentication attempts before lockout
    maxAttempts: 5
    # Account lockout duration
    lockoutDuration: 15m

  # Encryption at rest settings
  encryption:
    # Enable encryption for stored data (AES-256-GCM)
    enabled: false
    # Path to encryption key file (32 bytes raw or 64 hex chars)
    # Generate with: openssl rand -hex 32 > /etc/oba/encryption.key
    keyFile: ""

# Access Control List configuration
acl:
  # Default policy when no rule matches: allow, deny
  defaultPolicy: "deny"
  # ACL rules (evaluated in order)
  rules:
    # Admin has full access
    - target: "*"
      subject: "cn=admin,dc=example,dc=com"
      rights: ["read", "write", "add", "delete", "search", "compare"]
    # Authenticated users can read and search
    - target: "dc=example,dc=com"
      subject: "authenticated"
      rights: ["read", "search"]
    # Users can modify their own entry
    - target: "ou=users,dc=example,dc=com"
      subject: "self"
      rights: ["read", "write"]
      attributes: ["userPassword", "mail", "telephoneNumber"]
    # Anonymous can search for names only
    - target: "ou=users,dc=example,dc=com"
      subject: "anonymous"
      rights: ["search"]
      attributes: ["cn", "uid"]
